<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finalizar Agendamento - Agropecu√°ria Polar</title>
    <link rel="stylesheet" href="/css/reset.css" />
    <link rel="stylesheet" href="/css/GLOBAL.css" />
    <link rel="stylesheet" href="/css/finalizar-agendamento.css" />
    <link rel="stylesheet" href="/css/navbar.css" />
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/whatsapp.css" />

    <link rel="shortcut icon" href="/img/logo.png" type="image/x-icon" />

    <script src="/js/dropdown-menu.js"></script>
    <script src="/js/finalizar-agendamento.js" defer></script>
  </head>
  <body>
    <%- include("partials/header.ejs") %> <%- include("partials/navbarMenu.ejs")
    %>

    <div class="container">
      <div class="resumo-pedido">
        <h2>üìã Resumo do Agendamento</h2>

        <div class="info-card">
          <h3>üêæ Pet</h3>
          <div class="pet-info">
            <% if (pet.Imagem) { %>
            <img
              src="/uploads/pets/<%= pet.Imagem %>"
              alt="<%= pet.Nome %>"
              class="pet-thumb"
            />
            <% } else { %>
            <div class="pet-thumb-icon">
              <%= pet.Tipo === 'Cachorro' ? 'üê∂' : pet.Tipo === 'Gato' ? 'üê±' :
              'üêæ' %>
            </div>
            <% } %>
            <div>
              <strong><%= pet.Nome %></strong>
              <p><%= pet.Tipo %> ‚Ä¢ <%= pet.Sexo %> ‚Ä¢ <%= pet.Porte %></p>
            </div>
          </div>
        </div>

        <div class="info-card">
          <h3>‚ú® Servi√ßos</h3>
          <div class="servicos-lista">
            <% servicos.forEach(servico => { %>
            <div class="servico-resumo">
              <span><%= servico.Nome %></span>
              <span class="servico-valor">
                R$ <%= servico.Valor.toFixed(2).replace('.', ',') %>
              </span>
            </div>
            <% }) %>
            <div class="total-servicos">
              <strong>Total:</strong>
              <strong class="valor-total">
                R$ <%= valorTotal.toFixed(2).replace('.', ',') %>
              </strong>
            </div>
          </div>
        </div>
      </div>

      <div class="agendamento-section">
        <h2>üìÖ Escolha Data e Hor√°rio</h2>

        <div class="calendario-container">
          <div class="calendario-header">
            <button id="mesAnterior" class="btn-nav-mes">‚Üê</button>
            <h3 id="mesAno"></h3>
            <button id="proximoMes" class="btn-nav-mes">‚Üí</button>
          </div>
          <div class="calendario-dias-semana">
            <div>Dom</div>
            <div>Seg</div>
            <div>Ter</div>
            <div>Qua</div>
            <div>Qui</div>
            <div>Sex</div>
            <div>S√°b</div>
          </div>
          <div id="calendarioDias" class="calendario-dias"></div>
        </div>

        <div
          class="horarios-container"
          id="horariosContainer"
          style="display: none"
        >
          <h3>‚è∞ Hor√°rios Dispon√≠veis</h3>
          <div class="loading-horarios" id="loadingHorarios">
            Carregando hor√°rios dispon√≠veis...
          </div>
          <div id="horariosGrid" class="horarios-grid"></div>
        </div>

        <div class="observacoes-container">
          <h3>üìù Observa√ß√µes (opcional)</h3>
          <textarea
            id="observacoes"
            placeholder="Adicione informa√ß√µes importantes sobre seu pet ou prefer√™ncias para o atendimento..."
            maxlength="500"
          ></textarea>
          <small class="char-count">
            <span id="charCount">0</span>/500 caracteres
          </small>
        </div>

        <!-- Bot√£o Finalizar -->
        <button id="btnFinalizar" class="btn-finalizar" disabled>
          Confirmar Agendamento
        </button>
      </div>
    </div>
    <%-include("partials/whatsapp-button.ejs")%> <%-
    include("partials/footerCopy.ejs") %>

    <script>
      const petId = <%- JSON.stringify(pet.id) %>;
      const servicosIds = <%- JSON.stringify(servicos.map(s => s.id)) %>;
      const duracaoTotal = <%- JSON.stringify(duracaoTotal) %>;

      console.log("üêæ Dados recebidos do servidor:");
      console.log({ petId, servicosIds, duracaoTotal });
    </script>
    
  </body>
</html>
